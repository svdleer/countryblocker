# Country Blocker - Web Dashboard

A secure, read-only PHP dashboard for monitoring Country Blocker status.

## Features

- ğŸ“Š Real-time statistics display
- ğŸ”„ Auto-refresh every 60 seconds
- ğŸ”’ Security headers and read-only design
- ğŸ“± Responsive mobile-friendly layout
- ğŸ¨ Modern gradient design
- ğŸ›¡ï¸ Optional HTTP basic authentication

## Installation

### 1. Generate Statistics

Add this command to update web statistics:

```bash
sudo ipdeny-ctl update-web
```

This creates `/var/lib/ipdeny/stats.json` with current statistics.

### 2. Deploy to Web Server

#### Option A: Manual Copy

```bash
# Copy web files to your webroot
sudo cp -r /opt/ipdeny/web/* /var/www/html/countryblocker/

# Set proper permissions
sudo chown -R www-data:www-data /var/www/html/countryblocker
sudo chmod 755 /var/www/html/countryblocker
sudo chmod 644 /var/www/html/countryblocker/*
```

#### Option B: Automatic Deployment (Recommended)

```bash
# Enable automatic web deployment
sudo ipdeny-ctl setup-web /var/www/html/countryblocker

# This will:
# - Copy web files to specified directory
# - Set proper permissions
# - Create systemd timer to update stats every 5 minutes
```

### 3. Enable Basic Authentication (Recommended)

```bash
# Create password file
sudo htpasswd -c /var/www/.htpasswd admin

# Edit .htaccess and uncomment authentication lines
sudo nano /var/www/html/countryblocker/.htaccess
```

Uncomment these lines:
```apache
AuthType Basic
AuthName "Country Blocker Dashboard"
AuthUserFile /var/www/.htpasswd
Require valid-user
```

### 4. Access Dashboard

Visit: `https://your-domain.com/countryblocker/`

## Plesk Configuration

For Plesk servers:

```bash
# Find your domain's document root
# Usually: /var/www/vhosts/yourdomain.com/httpdocs/

# Deploy to Plesk webroot
sudo ipdeny-ctl setup-web /var/www/vhosts/yourdomain.com/httpdocs/countryblocker

# Set Plesk user permissions
sudo chown -R yourdomain:psacln /var/www/vhosts/yourdomain.com/httpdocs/countryblocker
```

Then access: `https://yourdomain.com/countryblocker/`

## Security Best Practices

1. âœ… **Enable HTTPS** - Uncomment SSL redirect in `.htaccess`
2. âœ… **Enable Authentication** - Use HTTP basic auth or integrate with your auth system
3. âœ… **Restrict IP Access** - Add IP whitelist in Apache/Nginx config
4. âœ… **Regular Updates** - Keep PHP and web server updated
5. âœ… **Monitor Access Logs** - Check for unauthorized access attempts

## File Structure

```
web/
â”œâ”€â”€ index.php          # Main dashboard (read-only)
â”œâ”€â”€ .htaccess          # Apache security configuration
â””â”€â”€ README.md          # This file
```

## Data Source

The dashboard reads from `/var/lib/ipdeny/stats.json`, which is generated by:

```bash
sudo ipdeny-ctl update-web
```

This JSON file contains:
- Timestamp of last update
- Summary statistics (countries, entries, packets, traffic)
- Per-ipset details (entries, memory, hits, traffic)

## Troubleshooting

### Dashboard shows "No statistics available"

Run: `sudo ipdeny-ctl update-web`

### Permission denied errors

Check ownership:
```bash
sudo chown -R www-data:www-data /var/www/html/countryblocker
ls -la /var/lib/ipdeny/stats.json
```

### Page not loading

Check Apache/PHP:
```bash
sudo systemctl status apache2
sudo tail -f /var/log/apache2/error.log
```

## Customization

### Change Refresh Interval

Edit `index.php`:
```php
define('REFRESH_INTERVAL', 30); // Change from 60 to 30 seconds
```

### Custom Styling

Add your CSS in the `<style>` section of `index.php`.

## License

MIT License - See main repository LICENSE file.

## Author

Silvester van der Leer (svdleer)
- GitHub: https://github.com/svdleer
- Repository: https://github.com/svdleer/countryblocker
